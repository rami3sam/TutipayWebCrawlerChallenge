/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.rami3sam.crawler;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;

public class Util {
    static String BASE_URL = "https://monzo.com";

    public static ArrayList<String> getPageLinks(String pageURL) {
        try {

            URL pageURLObject = new URL(pageURL);

            Document document = Jsoup.connect(pageURL).get();
            Elements anchorTags = document.getElementsByTag("a");

            ArrayList<String> links = new ArrayList<String>();

            for (Element anchorTag : anchorTags) {
                String tempURL = anchorTag.attr("href");
                if (!tempURL.startsWith("http://") && !tempURL.startsWith("https://")) {
                    // in case the url is a relative url add the current pages host as a prefix

                    // if it is just a fragment or query add current pages path
                    if (tempURL.startsWith("#") || tempURL.startsWith("?")) {
                        tempURL = pageURLObject.getFile() + tempURL;
                    }


                    if (!tempURL.startsWith("/")) {
                        tempURL = "/" + tempURL;
                    }
                    tempURL = pageURLObject.getProtocol() + "://" + pageURLObject.getAuthority() + tempURL;

                }

                // check if the URL is well formed if it is proceed to add it to the list else skip it
                URL url;
                try {
                    url = new URL(tempURL);
                } catch (MalformedURLException e) {
                    //e.printStackTrace();
                    continue;
                }

                //Strip the fragment from the url to get rid of duplicates
                String urlString = url.getProtocol() + "://" + url.getAuthority() + url.getFile();
                links.add(urlString);

            }

            return links;

        } catch (IOException e) {
            e.printStackTrace(System.err);
            return null;
        }
    }
    
}
